<html>
<body>
   <h2>Using the <i> fetch() browser method </i> to fetch data from API</h2>
   <div id = "output"> </div>
   <button onclick = "fetchData()"> Fetch API to get data </button> 
   <div id="chartContainer" style="width: 400px; height: 300px;">
      <canvas id="myChartHum"></canvas>

    </div>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script>
      let output = document.getElementById('output'); 
      function fetchData() {
         fetch('http://localhost:3000/data')
         .then(response => response.json()) //??
         .then(data => {
            function createChart(labelOfChart, ChartName, humidityId){
                    const xlabels = [];
                    const yvalues = [];

                    const tempArray = data[ChartName];
                    console.log(tempArray);

                    tempArray.forEach(item => {
                        xlabels.push(item.location);
                        yvalues.push(item.value);
                    });
                    console.log(xlabels);
                    console.log(yvalues);

                    const humidityChart = document.getElementById(humidityId);
                    humidityChart.parentNode.removeChild(humidityChart); //brise stari cart
                    const newCanvas = document.createElement('canvas'); //kreira novi canvac objekat
                    newCanvas.id = humidityId;
                    newCanvas.width = 400;
                    newCanvas.height = 300;
                    //preko diva iznad dodaje mali canvas!!
                    document.getElementById('chartContainer').appendChild(newCanvas);
                    
                    new Chart(newCanvas, {
                    type: 'line',
                    data: {
                        labels: xlabels,
                        datasets: [{
                        label: labelOfChart,
                        data: yvalues,
                        borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                        y: {
                            beginAtZero: true
                        }
                        }
                    }
                    });
            }
            const labelOfHumidityChart = 'level of humidity in %';
            const humidityChartName = "humidity" 
            const humidityId = 'myChartHum'
            createChart(labelOfHumidityChart, humidityChartName, humidityId);
        
         })
         .catch(error => {
            console.error('Error:', error);
         });
      }
   </script>
</body>
</html>